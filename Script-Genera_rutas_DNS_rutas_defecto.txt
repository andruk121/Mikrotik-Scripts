#Script que genera rutas de DNS y rutas por defecto - Capturando el GW automÃ¡ticamente
#Ingeniero Andres Aguillon
#21 de enero del 2021

#Captura el array donde esta contenido el GW de cada enlace
:global GWPrincipal [/ip arp get [/ip arp find where interface=ether2]];
:global GWBackup [/ip arp get [/ip arp find where interface=ether3]];

#Agrega rutas DNS GOOGLE
:ip route add comment="DNS GOOGLE Principal" dst-address=8.8.8.8 gateway=($GWPrincipal->"address") scope=10 target-scope=10
:ip route add comment="DNS GOOGLE Backup" dst-address=8.8.4.4 gateway=($GWBackup->"address") scope=10 target-scope=10

#Obtiene el array donde esta contenido el DNS de cada enlace
:global DNSGooglePrincipal [/ip route get [/ip route find where dst-address=8.8.8.8/32]];
:global DNSGoogleBackup [/ip route get [/ip route find where dst-address=8.8.4.4/32]];

#Obtiene el Sring contenido en el dst-address
:global GWPrincipalStr ($DNSGooglePrincipal->"dst-address");
:global GWBackupStr ($DNSGoogleBackup->"dst-address");

#Elimina caracteres no necesarios
:global GWPrincipalStr [:pick $GWPrincipalStr 0 [:find $GWPrincipalStr "/32"]];
:global GWBackupStr [:pick $GWBackupStr 0 [:find $GWBackupStr "/32"]];

#Agrega rutas por defecto
:ip route add comment="Default route GOOGLE Principal" dst-address=0.0.0.0/0 gateway=($GWPrincipalStr) distance=3 scope=30 target-scope=10
:ip route add comment="Default route GOOGLE Backup" dst-address=0.0.0.0/0 gateway=($GWBackupStr) distance=4 scope=30 target-scope=10

#Agrega Rutas DNS Google si es VPBOX
:ip route add comment="DNS GOOGLE Principal" dst-address=8.8.8.8 gateway=HITPP scope=10 target-scope=10
:ip route add comment="DNS GOOGLE Backup" dst-address=8.8.4.4 gateway=HITBK scope=10 target-scope=10